<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Registry</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
    </style>
</head>
<body>
    <h1>Simple Registry Interface</h1>
    <div>
        <label for="nameInput">Enter your name:</label>
        <input type="text" id="nameInput">
        <button onclick="registerName()">Register</button>
    </div>
    <div>
        <h2>Registered Name:</h2>
        <p id="registeredName"></p>
    </div>

    <!-- Include Web3.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>

    <script>
        // Ethereum provider setup (MetaMask)
        const ethereumProvider = window.ethereum;
        ethereumProvider.request({ method: 'eth_requestAccounts' });

        // Contract ABI (interface)
        const contractAbi = [
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "_name",
                        "type": "string"
                    }
                ],
                "name": "register",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_user",
                        "type": "address"
                    }
                ],
                "name": "getName",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "registrations",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // Contract address (deployed on Sepolia testnet via Remix IDE)
        const contractAddress = '0xd7cf75e9f810247e16d9bc40151f7b6284731400';

        // Web3 initialization
        const web3 = new Web3(ethereumProvider);
        const contractInstance = new web3.eth.Contract(contractAbi, contractAddress);

        // Function to register name
        async function registerName() {
            const name = document.getElementById('nameInput').value;
            try {
                const accounts = await ethereumProvider.request({ method: 'eth_requestAccounts' });
                const account = accounts[0];
                await contractInstance.methods.register(name).send({ from: account });
                alert('Name registered successfully!');
            } catch (error) {
                console.error(error);
                alert('Failed to register name.');
            }
        }

        // Function to retrieve registered name
        async function getRegisteredName() {
            try {
                const accounts = await ethereumProvider.request({ method: 'eth_requestAccounts' });
                const account = accounts[0];
                const registeredName = await contractInstance.methods.getName(account).call();
                document.getElementById('registeredName').textContent = registeredName;
            } catch (error) {
                console.error(error);
                alert('Failed to retrieve registered name.');
            }
        }

        // Initial call to retrieve registered name (on page load)
        getRegisteredName();
    </script>
</body>
</html>
